<template>
    <div data-name="barchart" class="page">
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding">
              <div class="left">
                <a href="#" class="link back">
                  <i class="icon icon-back"></i>
                  <span class="if-not-md">Back</span>
                </a>
              </div>
              <div class="title">Chart</div>
            </div>
          </div>

        <div class="page-content">
            <button @click="dadosGraficoDayOne"> AUMENTE SEU PENIS </button>
            <canvas id="myChart"></canvas>
                <input type="text" placeholder="insira o nome do segundo pais" id="CHAMAFI">
                <button @click="compareFirstCountryToNextCountry">ADD</button>
            <canvas id="myChart2"></canvas>
        </div>
    </div>
</template>
<script>
    import $$ from 'dom7';
    import Chart from 'chart.js';
    export default {
        on: {
            pageInit: function (e, page) {
                var ctx = $$("#myChart");
                var myChart = new Chart(ctx, {
                    type: 'horizontalBar',
                    data: {
                        labels: ["January", "February", "March"],
                        datasets: [{
                            label: 'Recovereds',
                            data: [100, 20, 1],
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Infecteds',
                            data: [150, 35, 3],
                            backgroundColor: 'rgba(255, 206, 86, 0.5)',
                            borderColor: 'rgba(255, 206, 86, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Deaths',
                            data: [300, 70, 10],
                            backgroundColor: 'rgba(255, 99, 132, 0.5)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });
                return true
                var ctx2 = $$("#myChart2");
                var myChart = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: [1500, 1600, 1700, 1750, 1800, 1850, 1900, 1950, 1999, 2050],
                        datasets: [{
                            data: [86, 114, 106, 106, 107, 111, 133, 221, 783, 2478],
                            label: "Africa",
                            borderColor: "#3e95cd",
                            fill: false
                        }, {
                            data: [282, 350, 411, 502, 635, 809, 947, 1402, 3700, 5267],
                            label: "Asia",
                            borderColor: "#8e5ea2",
                            fill: false
                        }, {
                            data: [168, 170, 178, 190, 203, 276, 408, 547, 675, 734],
                            label: "Europe",
                            borderColor: "#3cba9f",
                            fill: false
                        }, {
                            data: [40, 20, 10, 16, 24, 38, 74, 167, 508, 784],
                            label: "Latin America",
                            borderColor: "#e8c3b9",
                            fill: false
                        }, {
                            data: [6, 3, 2, 2, 7, 26, 82, 172, 312, 433],
                            label: "North America",
                            borderColor: "#c45850",
                            fill: false
                        }
                        ]
                    },
                    options: {
                        title: {
                            display: true,
                            text: 'World population per region (in millions)'
                        },
                        scales:{
                            xAxes:[{
                                display:true
                            }],
                            yAxes: [{
                                display: true,
                                type: 'logarithmic'
                            }]
                        }
                    }
                });
            },
        },
        methods:{
            compareFirstCountryToNextCountry(){
                var firstchartdata = sessionStorage["firstchartdata"]
                if(typeof firstchartdata === 'undefined'){
                    this.$f7.dialog.alert('Clica no botao la em cima pfvr ajuda ae pae')
                    return
                }
                firstchartdata = JSON.parse(firstchartdata)
                var country = $$("#CHAMAFI").val()
                var url = "https://api.covid19api.com/total/country/".concat(country, "/status/confirmed")
                var cor = "#8e5ea2"
                var self = this
                let dadosFormatados
                let labels
                this.$f7.request.get(url, null, function (data) {
                   let dataarray = JSON.parse(data)
                   dadosFormatados = []
                   labels = [0]
                   let indice = 1
                   dataarray.forEach(element=>{
                            labels.push(indice++)
                            dadosFormatados.push(element.Cases)
                    }) 
                    var secondchartdata = {
                                data:dadosFormatados, label:country, borderColor:cor, fill:false
                            }
                    var myChart = new Chart($$("#myChart2"), {
                        type: 'line',
                        data: {
                            labels:labels,
                            datasets: [firstchartdata, secondchartdata]                            
                        }, options: {
                                  title: {
                                    display: true,
                                    text: `Curva de aumento de casos (logaritimica)`
                                },
                                scales:{
                                    xAxes:[{
                                        display:true
                                    }],
                                    yAxes: [{
                                        display: true,
                                        type: 'logarithmic'
                                    }]
                                }
                            }
                        })

                    self.$update()   
                });                      
            },
            dadosGraficoDayOne(pais, color){
                let country = "brazil"
                var url = "https://api.covid19api.com/total/country/".concat(country, "/status/confirmed")
                var cor = "#c45850"
                var self = this
                let dadosFormatados
                let labels
                this.$f7.request.get(url, null, function (data) {
                   let dataarray = JSON.parse(data)
                   dadosFormatados = []
                   labels = [0]
                   let indice = 1
                   dataarray.forEach(element=>{
                            labels.push(indice++)
                            dadosFormatados.push(element.Cases)
                    }) 
                    var firstchartdata = {
                                data:dadosFormatados, label:country, borderColor:cor, fill:false
                            }
                    var myChart = new Chart($$("#myChart2"), {
                        type: 'line',
                        data: {
                            labels:labels,
                            datasets: [firstchartdata]                            
                        }, options: {
                                  title: {
                                    display: true,
                                    text: `Curva de aumento de casos (logaritimica)`
                                },
                                scales:{
                                    xAxes:[{
                                        display:true
                                    }],
                                    yAxes: [{
                                        display: true,
                                        type: 'logarithmic'
                                    }]
                                }
                            }
                        })
                        var myObj = firstchartdata
                        sessionStorage["firstchartdata"] = JSON.stringify({data:dadosFormatados, label:country, borderColor:cor, fill:false})

                    self.$update()   
                });                      
            }   
        }
     }
</script>